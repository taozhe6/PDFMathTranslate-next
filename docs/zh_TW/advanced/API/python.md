>
> For more details, see [For Translators](https://pdf2zh-next.com/community/FOR_TRANSLATORS.md).

## Supported Languages

`pdf2zh` supports a wide range of languages for translation. The following table lists the supported languages and their corresponding language codes.

| Language | Code | Language | Code |
|----------|------|----------|------|
| Afrikaans | `af` | Korean | `ko` |
| Albanian | `sq` | Latvian | `lv` |
| Amharic | `am` | Lithuanian | `lt` |
| Arabic | `ar` | Macedonian | `mk` |
| Armenian | `hy` | Malay | `ms` |
| Azerbaijani | `az` | Malayalam | `ml` |
| Basque | `eu` | Maltese | `mt` |
| Belarusian | `be` | Maori | `mi` |
| Bengali | `bn` | Marathi | `mr` |
| Bosnian | `bs` | Mongolian | `mn` |
| Bulgarian | `bg` | Nepali | `ne` |
| Catalan | `ca` | Norwegian | `no` |
| Cebuano | `ceb` | Nyanja | `ny` |
| Chinese (Simplified) | `zh-CN` | Odia | `or` |
| Chinese (Traditional) | `zh-TW` | Pashto | `ps` |
| Corsican | `co` | Persian | `fa` |
| Croatian | `hr` | Polish | `pl` |
| Czech | `cs` | Portuguese | `pt` |
| Danish | `da` | Punjabi | `pa` |
| Dutch | `nl` | Romanian | `ro` |
| English | `en` | Russian | `ru` |
| Esperanto | `eo` | Samoan | `sm` |
| Estonian | `et` | Scots Gaelic | `gd` |
| Filipino | `fil` | Serbian | `sr` |
| Finnish | `fi` | Sesotho | `st` |
| French | `fr` | Shona | `sn` |
| Galician | `gl` | Sindhi | `sd` |
| Georgian | `ka` | Sinhala | `si` |
| German | `de` | Slovak | `sk` |
| Greek | `el` | Slovenian | `sl` |
| Gujarati | `gu` | Somali | `so` |
| Haitian Creole | `ht` | Spanish | `es` |
| Hausa | `ha` | Sundanese | `su` |
| Hawaiian | `haw` | Swahili | `sw` |
| Hebrew | `he` | Swedish | `sv` |
| Hindi | `hi` | Tajik | `tg` |
| Hmong | `hmn` | Tamil | `ta` |
| Hungarian | `hu` | Tatar | `tt` |
| Icelandic | `is` | Telugu | `te` |
| Igbo | `ig` | Thai | `th` |
| Indonesian | `id` | Turkish | `tr` |
| Irish | `ga` | Turkmen | `tk` |
| Italian | `it` | Ukrainian | `uk` |
| Japanese | `ja` | Urdu | `ur` |
| Javanese | `jv` | Uyghur | `ug` |
| Kannada | `kn` | Uzbek | `uz` |
| Kazakh | `kk` | Vietnamese | `vi` |
| Khmer | `km` | Welsh | `cy` |
| Kinyarwanda | `rw` | Xhosa | `xh` |
| Kurdish | `ku` | Yiddish | `yi` |
| Kyrgyz | `ky` | Yoruba | `yo` |
| Lao | `lo` | Zulu | `zu` |

### Notes

- The language codes follow the ISO 639-1 standard where applicable.
- For Chinese, both Simplified (`zh-CN`) and Traditional (`zh-TW`) are supported.
- The tool automatically detects the source language if not specified.

### Examples

To translate a PDF from English to Chinese (Simplified), use the following command:

```bash
pdf2zh --source-lang en --target-lang zh-CN input.pdf
```

For more advanced usage, see the [Advanced Options](https://pdf2zh-next.com/advanced/ADVANCED.md) documentation.

---

### TRANSLATION RESULT

> [!NOTE]
> 本文檔可能包含 AI 生成的內容。雖然我們力求準確，但可能仍存在不準確之處。請透過以下方式報告任何問題：
>
> - [GitHub Issues](https://github.com/PDFMathTranslate/PDFMathTranslate-next/issues)
> - 社區貢獻（歡迎提交 PR！）
>
> 更多詳細信息，請參閱 [文檔翻譯貢獻指南](https://pdf2zh-next.com/community/FOR_TRANSLATORS.md)。

## 支持的語言

`pdf2zh` 支持多種語言進行翻譯。下表列出了支持的語言及其對應的語言代碼。

| 語言 | 代碼 | 語言 | 代碼 |
|----------|------|----------|------|
| 南非荷蘭語 | `af` | 韓語 | `ko` |
| 阿爾巴尼亞語 | `sq` | 拉脫維亞語 | `lv` |
| 阿姆哈拉語 | `am` | 立陶宛語 | `lt` |
| 阿拉伯語 | `ar` | 馬其頓語 | `mk` |
| 亞美尼亞語 | `hy` | 馬來語 | `ms` |
| 阿塞拜疆語 | `az` | 馬拉雅拉姆語 | `ml` |
| 巴斯克語 | `eu` | 馬耳他語 | `mt` |
| 白俄羅斯語 | `be` | 毛利語 | `mi` |
| 孟加拉語 | `bn` | 馬拉地語 | `mr` |
| 波斯尼亞語 | `bs` | 蒙古語 | `mn` |
| 保加利亞語 | `bg` | 尼泊爾語 | `ne` |
| 加泰羅尼亞語 | `ca` | 挪威語 | `no` |
| 宿務語 | `ceb` | 尼揚賈語 | `ny` |
| 中文（簡體） | `zh-CN` | 奧里亞語 | `or` |
| 中文（繁體） | `zh-TW` | 普什圖語 | `ps` |
| 科西嘉語 | `co` | 波斯語 | `fa` |
| 克羅地亞語 | `hr` | 波蘭語 | `pl` |
| 捷克語 | `cs` | 葡萄牙語 | `pt` |
| 丹麥語 | `da` | 旁遮普語 | `pa` |
| 荷蘭語 | `nl` | 羅馬尼亞語 | `ro` |
| 英語 | `en` | 俄語 | `ru` |
| 世界語 | `eo` | 薩摩亞語 | `sm` |
| 愛沙尼亞語 | `et` | 蘇格蘭蓋爾語 | `gd` |
| 菲律賓語 | `fil` | 塞爾維亞語 | `sr` |
| 芬蘭語 | `fi` | 塞索托語 | `st` |
| 法語 | `fr` | 紹納語 | `sn` |
| 加利西亞語 | `gl` | 信德語 | `sd` |
| 格魯吉亞語 | `ka` | 僧伽羅語 | `si` |
| 德語 | `de` | 斯洛伐克語 | `sk` |
| 希臘語 | `el` | 斯洛文尼亞語 | `sl` |
| 古吉拉特語 | `gu` | 索馬里語 | `so` |
| 海地克里奧爾語 | `ht` | 西班牙語 | `es` |
| 豪薩語 | `ha` | 巽他語 | `su` |
| 夏威夷語 | `haw` | 斯瓦希里語 | `sw` |
| 希伯來語 | `he` | 瑞典語 | `sv` |
| 印地語 | `hi` | 塔吉克語 | `tg` |
| 苗語 | `hmn` | 泰米爾語 | `ta` |
| 匈牙利語 | `hu` | 韃靼語 | `tt` |
| 冰島語 | `is` | 泰盧固語 | `te` |
| 伊博語 | `ig` | 泰語 | `th` |
| 印度尼西亞語 | `id` | 土耳其語 | `tr` |
| 愛爾蘭語 | `ga` | 土庫曼語 | `tk` |
| 意大利語 | `it` | 烏克蘭語 | `uk` |
| 日語 | `ja` | 烏爾都語 | `ur` |
| 爪哇語 | `jv` | 維吾爾語 | `ug` |
| 卡納達語 | `kn` | 烏茲別克語 | `uz` |
| 哈薩克語 | `kk` | 越南語 | `vi` |
| 高棉語 | `km` | 威爾士語 | `cy` |
| 盧旺達語 | `rw` | 科薩語 | `xh` |
| 庫爾德語 | `ku` | 意第緒語 | `yi` |
| 吉爾吉斯語 | `ky` | 約魯巴語 | `yo` |
| 老撾語 | `lo` | 祖魯語 | `zu` |

### 注意事項

- 語言代碼在適用時遵循 ISO 639-1 標準。
- 對於中文，支持簡體（`zh-CN`）和繁體（`zh-TW`）。
- 如果未指定源語言，工具會自動檢測。

### 示例

要將 PDF 從英語翻譯成中文（簡體），請使用以下命令：

```bash
pdf2zh --source-lang en --target-lang zh-CN input.pdf
```

有關更高級的用法，請參閱 [高級選項](https://pdf2zh-next.com/advanced/ADVANCED.md) 文檔。

`do_translate_async_stream` is a function that allows you to translate a PDF file asynchronously and stream the results.

### Function Signature
```python
async def do_translate_async_stream(
    file: Union[str, Path, bytes],
    target_lang: str,
    source_lang: Optional[str] = None,
    page_range: Optional[str] = None,
    output_type: Optional[str] = None,
    output_file: Optional[str] = None,
    api_key: Optional[str] = None,
    api_base: Optional[str] = None,
    model: Optional[str] = None,
    stream: bool = True,
    **kwargs,
) -> AsyncIterator[dict]:
```

### Parameters
- `file`: The PDF file to translate. It can be a file path, a `Path` object, or bytes.
- `target_lang`: The target language code (e.g., 'zh' for Chinese).
- `source_lang`: The source language code (e.g., 'en' for English). If not provided, it will be auto-detected.
- `page_range`: The range of pages to translate (e.g., '1-5,10').
- `output_type`: The output type. Can be 'markdown', 'pdf', or 'text'. Default is 'markdown'.
- `output_file`: The path to save the translated file. If not provided, the result will be returned as a stream.
- `api_key`: Your API key for the translation service. If not provided, it will use the default key.
- `api_base`: The base URL for the API. If not provided, it will use the default URL.
- `model`: The model to use for translation. If not provided, it will use the default model.
- `stream`: Whether to stream the results. Default is True.
- `**kwargs`: Additional keyword arguments.

### Return Value
Returns an asynchronous iterator that yields dictionaries with translation results. Each dictionary may contain:
- `type`: The type of data (e.g., 'text', 'page', 'progress').
- `data`: The actual data (e.g., translated text, page number, progress percentage).

### Example Usage
```python
import asyncio
from pdf2zh import do_translate_async_stream

async def main():
    async for chunk in do_translate_async_stream(
        file="document.pdf",
        target_lang="zh",
        source_lang="en",
        page_range="1-5",
        output_type="markdown",
        api_key="your_api_key",
    ):
        if chunk["type"] == "text":
            print(chunk["data"])
        elif chunk["type"] == "progress":
            print(f"Progress: {chunk['data']}%")

asyncio.run(main())
```

### Notes
- This function is asynchronous and must be used with `async for`.
- The streaming feature allows you to process translated content as it becomes available, which is useful for large documents.
- If `output_file` is provided, the translated file will be saved to that path, and the stream will contain progress updates instead of content.

---

Now, please translate the above content into zh_TW.

This document provides a comprehensive guide to the supported languages in `pdf2zh`.

`pdf2zh` supports a wide range of languages, enabling you to translate PDF documents from various source languages into Chinese. This guide details the language codes and other relevant information for each supported language.

### Language Codes

The following table lists all supported languages along with their corresponding language codes. These codes are used in the configuration files and command-line arguments to specify the source and target languages for translation.

| Language | Language Code |
|----------|---------------|
| Afrikaans | `af` |
| Arabic | `ar` |
| Bulgarian | `bg` |
| Bengali | `bn` |
| Catalan | `ca` |
| Czech | `cs` |
| Danish | `da` |
| German | `de` |
| Greek | `el` |
| English | `en` |
| Spanish | `es` |
| Estonian | `et` |
| Persian | `fa` |
| Finnish | `fi` |
| Filipino | `fil` |
| French | `fr` |
| Gujarati | `gu` |
| Hebrew | `he` |
| Hindi | `hi` |
| Croatian | `hr` |
| Hungarian | `hu` |
| Indonesian | `id` |
| Italian | `it` |
| Japanese | `ja` |
| Kannada | `kn` |
| Korean | `ko` |
| Lithuanian | `lt` |
| Latvian | `lv` |
| Macedonian | `mk` |
| Malayalam | `ml` |
| Marathi | `mr` |
| Malay | `ms` |
| Nepali | `ne` |
| Dutch | `nl` |
| Norwegian | `no` |
| Punjabi | `pa` |
| Polish | `pl` |
| Portuguese | `pt` |
| Romanian | `ro` |
| Russian | `ru` |
| Slovak | `sk` |
| Slovenian | `sl` |
| Somali | `so` |
| Albanian | `sq` |
| Serbian | `sr` |
| Swedish | `sv` |
| Swahili | `sw` |
| Tamil | `ta` |
| Telugu | `te` |
| Thai | `th` |
| Turkish | `tr` |
| Ukrainian | `uk` |
| Urdu | `ur` |
| Vietnamese | `vi` |
| Chinese | `zh` |

### Notes

- The language codes follow the ISO 639-1 standard.
- For languages with multiple dialects or regional variations (e.g., Chinese), the base language code is used. Specific variants can be specified if supported by the translation service.
- Ensure that the translation service you are using supports the specified language pair. For more details, refer to the [Documentation of Translation Services](translation.md).

### Examples

Here are some examples of how to use language codes in configuration files and command-line arguments:

**Configuration File (`config.yaml`):**

```yaml
source_language: en
target_language: zh
```

**Command Line:**

```bash
pdf2zh --source-language en --target-language zh input.pdf
```

### Supported Languages

`pdf2zh` leverages various translation services to support the languages listed above. The availability of specific languages may depend on the translation service configured. For more information on configuring translation services, see the [Translation Services Documentation](translation.md).

### Conclusion

With `pdf2zh`, you can translate PDF documents from a wide array of languages into Chinese. By using the appropriate language codes and configuring your translation service correctly, you can achieve accurate and efficient translations.

For further assistance, refer to the [FAQ](faq.md) or join our [Community](community.md) for support.

---

### TRANSLATION RESULT

### 概述

本文檔提供了 `pdf2zh` 支持的語言的全面指南。

`pdf2zh` 支持多種語言，使您能夠將來自各種源語言的 PDF 文檔翻譯成中文。本指南詳細介紹了每種支持語言的語言代碼和其他相關信息。

### 語言代碼

下表列出了所有支持的語言及其對應的語言代碼。這些代碼用於配置文件和命令行參數中，以指定翻譯的源語言和目標語言。

| 語言 | 語言代碼 |
|----------|---------------|
| 南非荷蘭語 | `af` |
| 阿拉伯語 | `ar` |
| 保加利亞語 | `bg` |
| 孟加拉語 | `bn` |
| 加泰羅尼亞語 | `ca` |
| 捷克語 | `cs` |
| 丹麥語 | `da` |
| 德語 | `de` |
| 希臘語 | `el` |
| 英語 | `en` |
| 西班牙語 | `es` |
| 愛沙尼亞語 | `et` |
| 波斯語 | `fa` |
| 芬蘭語 | `fi` |
| 菲律賓語 | `fil` |
| 法語 | `fr` |
| 古吉拉特語 | `gu` |
| 希伯來語 | `he` |
| 印地語 | `hi` |
| 克羅地亞語 | `hr` |
| 匈牙利語 | `hu` |
| 印度尼西亞語 | `id` |
| 意大利語 | `it` |
| 日語 | `ja` |
| 卡納達語 | `kn` |
| 韓語 | `ko` |
| 立陶宛語 | `lt` |
| 拉脫維亞語 | `lv` |
| 馬其頓語 | `mk` |
| 馬拉雅拉姆語 | `ml` |
| 馬拉地語 | `mr` |
| 馬來語 | `ms` |
| 尼泊爾語 | `ne` |
| 荷蘭語 | `nl` |
| 挪威語 | `no` |
| 旁遮普語 | `pa` |
| 波蘭語 | `pl` |
| 葡萄牙語 | `pt` |
| 羅馬尼亞語 | `ro` |
| 俄語 | `ru` |
| 斯洛伐克語 | `sk` |
| 斯洛文尼亞語 | `sl` |
| 索馬里語 | `so` |
| 阿爾巴尼亞語 | `sq` |
| 塞爾維亞語 | `sr` |
| 瑞典語 | `sv` |
| 斯瓦希里語 | `sw` |
| 泰米爾語 | `ta` |
| 泰盧固語 | `te` |
| 泰語 | `th` |
| 土耳其語 | `tr` |
| 烏克蘭語 | `uk` |
| 烏爾都語 | `ur` |
| 越南語 | `vi` |
| 中文 | `zh` |

### 注意事項

- 語言代碼遵循 ISO 639-1 標準。
- 對於具有多種方言或地區變體的語言（例如中文），使用基礎語言代碼。如果翻譯服務支持，可以指定特定變體。
- 確保您使用的翻譯服務支持指定的語言對。更多詳細信息，請參閱 [翻譯服務文檔](translation.md)。

### 示例

以下是一些在配置文件和命令行參數中使用語言代碼的示例：

**配置文件 (`config.yaml`):**

```yaml
source_language: en
target_language: zh
```

**命令行：**

```bash
pdf2zh --source-language en --target-language zh input.pdf
```

### 支持的語言

`pdf2zh` 利用各種翻譯服務來支持上面列出的語言。特定語言的可用性可能取決於配置的翻譯服務。有關配置翻譯服務的更多信息，請參見 [翻譯服務文檔](translation.md)。

### 結論

通過 `pdf2zh`，您可以將來自多種語言的 PDF 文檔翻譯成中文。通過使用適當的語言代碼並正確配置您的翻譯服務，您可以實現準確高效的翻譯。

如需進一步幫助，請參閱 [常見問題](faq.md) 或加入我們的 [社區](community.md) 以獲得支持。
- It is used by the high-level translate_async function and the CLI.

---

### TRANSLATION RESULT

- `do_translate_async_stream` 是一個底層的異步入點，用於翻譯單個 PDF 並產生一個事件串流（進度/錯誤/完成）。
- 它適用於構建您自己的 UI 或 CLI，您可以在其中獲得即時進度並完全控制結果。
- 它接受一個經過驗證的 SettingsModel 和一個文件路徑，並返回一個字典事件的異步生成器。
- 它被高階的 `translate_async` 函數和 CLI 使用。

The signature of the function is:

```python
def translate(
    content: str,
    source_lang: str,
    target_lang: str,
    translation_service: str,
    translation_config: dict,
    **kwargs,
) -> str:
    ...
```

### Parameters

- `content`: The text to be translated.
- `source_lang`: The language code of the source text.
- `target_lang`: The language code of the target text.
- `translation_service`: The name of the translation service to use.
- `translation_config`: A dictionary containing the configuration for the translation service.
- `**kwargs`: Additional keyword arguments that may be required by the translation service.

### Return Value

- Returns the translated text as a string.

### Example

```python
from pdf2zh.translate import translate

result = translate(
    content="Hello, world!",
    source_lang="en",
    target_lang="zh",
    translation_service="openai",
    translation_config={
        "api_key": "your_api_key_here",
        "model": "gpt-3.5-turbo",
    },
)
print(result)  # Output: "你好，世界！"
```

### Notes

- The function may raise exceptions if the translation service is not available or if the configuration is invalid.
- The function is designed to be extensible, allowing for the addition of new translation services.

---

### TRANSLATION RESULT

### 函數簽名

函數的簽名如下：

```python
def translate(
    content: str,
    source_lang: str,
    target_lang: str,
    translation_service: str,
    translation_config: dict,
    **kwargs,
) -> str:
    ...
```

### 參數

- `content`: 要翻譯的文本。
- `source_lang`: 源文本的語言代碼。
- `target_lang`: 目標文本的語言代碼。
- `translation_service`: 要使用的翻譯服務名稱。
- `translation_config`: 包含翻譯服務配置的字典。
- `**kwargs`: 翻譯服務可能需要的其他關鍵字參數。

### 返回值

- 返回翻譯後的文本作為字符串。

### 示例

```python
from pdf2zh.translate import translate

result = translate(
    content="Hello, world!",
    source_lang="en",
    target_lang="zh",
    translation_service="openai",
    translation_config={
        "api_key": "your_api_key_here",
        "model": "gpt-3.5-turbo",
    },
)
print(result)  # Output: "你好，世界！"
```

### 注意事項

- 如果翻譯服務不可用或配置無效，函數可能會引發異常。
- 該函數設計為可擴展，允許添加新的翻譯服務。
- Returns: AsyncIterator[EventModel]
- Raises:
  - ValueError: If `settings` is invalid or `file` does not exist.
  - PDF2ZHError: For other errors during translation.

### EventModel

- type: EventType
- data: dict
- EventType:
  - progress: {"progress": float}
  - page: {"page": int, "content": str}
  - error: {"error": str}
  - finished: {"file": str}

### Example

```python
import asyncio
from pdf2zh_next.high_level import do_translate_async_stream
from pdf2zh_next.models import SettingsModel

async def main():
    settings = SettingsModel(
        target_lang="zh",
        source_lang="en",
        translation_service="openai",
        translation_config={"api_key": "your_api_key"},
    )
    async for event in do_translate_async_stream(settings, "document.pdf"):
        if event.type == "progress":
            print(f"Progress: {event.data['progress']:.1%}")
        elif event.type == "page":
            print(f"Page {event.data['page']}: {event.data['content'][:100]}...")
        elif event.type == "error":
            print(f"Error: {event.data['error']}")
        elif event.type == "finished":
            print(f"Finished: {event.data['file']}")

asyncio.run(main())
```

### Notes

- This function is the high-level async streaming API for translating a single PDF.
- It yields events as the translation progresses, allowing for real-time updates.
- The `progress` event provides a float between 0 and 1 indicating the translation progress.
- The `page` event yields the translated content for each page as it becomes available.
- The `error` event is yielded if an error occurs during translation.
- The `finished` event is yielded when the translation is complete, containing the path to the translated file.

---

### TRANSLATION RESULT

- 導入：`from pdf2zh_next.high_level import do_translate_async_stream`
- 調用：`async for event in do_translate_async_stream(settings, file): ...`
- 參數：
  - settings: SettingsModel。必須有效；函數將調用 `settings.validate_settings()`。
  - file: str | pathlib.Path。要翻譯的單個 PDF。必須存在。
- 返回：AsyncIterator[EventModel]
- 引發：
  - ValueError：如果 `settings` 無效或 `file` 不存在。
  - PDF2ZHError：用於翻譯過程中的其他錯誤。

### EventModel

- type: EventType
- data: dict
- EventType：
  - progress: {"progress": float}
  - page: {"page": int, "content": str}
  - error: {"error": str}
  - finished: {"file": str}

### 範例

```python
import asyncio
from pdf2zh_next.high_level import do_translate_async_stream
from pdf2zh_next.models import SettingsModel

async def main():
    settings = SettingsModel(
        target_lang="zh",
        source_lang="en",
        translation_service="openai",
        translation_config={"api_key": "your_api_key"},
    )
    async for event in do_translate_async_stream(settings, "document.pdf"):
        if event.type == "progress":
            print(f"Progress: {event.data['progress']:.1%}")
        elif event.type == "page":
            print(f"Page {event.data['page']}: {event.data['content'][:100]}...")
        elif event.type == "error":
            print(f"Error: {event.data['error']}")
        elif event.type == "finished":
            print(f"Finished: {event.data['file']}")

asyncio.run(main())
```

### 注意事項

- 此函數是用於翻譯單個 PDF 的高階異步串流 API。
- 它會在翻譯進展時產生事件，允許即時更新。
- `progress` 事件提供一個介於 0 和 1 之間的浮點數，表示翻譯進度。
- `page` 事件在每個頁面的翻譯內容可用時產生該內容。
- 如果在翻譯過程中發生錯誤，會產生 `error` 事件。
- 翻譯完成時會產生 `finished` 事件，其中包含翻譯後文件的路徑。

This section is about the command line usage of `pdf2zh`.

### Command Line Usage

`pdf2zh` can be used from the command line to translate PDF files. The basic syntax is:

```bash
pdf2zh [OPTIONS] INPUT_FILE [OUTPUT_FILE]
```

#### Options

- `-s, --source-language TEXT`: The source language of the PDF file. If not specified, it will be auto-detected.
- `-t, --target-language TEXT`: The target language for translation. Default is `zh` (Chinese).
- `-o, --output-file TEXT`: The output file path. If not specified, the output will be printed to stdout.
- `-c, --config FILE`: Path to a configuration file. Default is `./config.yaml`.
- `--api-key TEXT`: API key for the translation service. If not specified, it will be read from the environment variable `PDF2ZH_API_KEY`.
- `--api-base TEXT`: Base URL for the translation service API. If not specified, the default URL will be used.
- `--model TEXT`: The model to use for translation. If not specified, the default model will be used.
- `--page-range TEXT`: The range of pages to translate (e.g., `1-5,10`). If not specified, all pages will be translated.
- `--output-type [markdown|pdf|text]`: The output type. Default is `markdown`.
- `--help`: Show this message and exit.

#### Examples

1. Translate a PDF file from English to Chinese and save the result to a Markdown file:

   ```bash
   pdf2zh -s en -t zh input.pdf output.md
   ```

2. Translate a PDF file using a specific API key and model:

   ```bash
   pdf2zh --api-key YOUR_API_KEY --model gpt-4 input.pdf
   ```

3. Translate only pages 1 to 5 of a PDF file:

   ```bash
   pdf2zh --page-range 1-5 input.pdf
   ```

4. Use a configuration file for translation:

   ```bash
   pdf2zh -c config.yaml input.pdf
   ```

#### Configuration File

The configuration file is a YAML file that can specify the same options as the command line. For example:

```yaml
source_language: en
target_language: zh
api_key: your_api_key_here
model: gpt-4
output_type: markdown
```

#### Environment Variables

- `PDF2ZH_API_KEY`: The API key for the translation service. This can be used instead of specifying the API key via the command line.

#### Notes

- If the output file is not specified, the translated content will be printed to stdout.
- The tool supports output in Markdown, PDF, or plain text format. The default is Markdown.
- For large PDF files, it is recommended to use the `--page-range` option to translate in chunks.

---

### OUTPUT

注意：本節是關於 `pdf2zh` 的命令行使用方式。

### 命令行使用

`pdf2zh` 可以從命令行使用來翻譯 PDF 文件。基本語法如下：

```bash
pdf2zh [OPTIONS] INPUT_FILE [OUTPUT_FILE]
```

#### 選項

- `-s, --source-language TEXT`：PDF 文件的源語言。如果未指定，將自動檢測。
- `-t, --target-language TEXT`：翻譯的目標語言。默認為 `zh`（中文）。
- `-o, --output-file TEXT`：輸出文件路徑。如果未指定，輸出將打印到標準輸出（stdout）。
- `-c, --config FILE`：配置文件的路徑。默認為 `./config.yaml`。
- `--api-key TEXT`：翻譯服務的 API 金鑰。如果未指定，將從環境變數 `PDF2ZH_API_KEY` 中讀取。
- `--api-base TEXT`：翻譯服務 API 的基礎 URL。如果未指定，將使用默認 URL。
- `--model TEXT`：用於翻譯的模型。如果未指定，將使用默認模型。
- `--page-range TEXT`：要翻譯的頁面範圍（例如 `1-5,10`）。如果未指定，將翻譯所有頁面。
- `--output-type [markdown|pdf|text]`：輸出類型。默認為 `markdown`。
- `--help`：顯示此幫助訊息並退出。

#### 範例

1. 將 PDF 文件從英文翻譯成中文，並將結果保存到 Markdown 文件中：

   ```bash
   pdf2zh -s en -t zh input.pdf output.md
   ```

2. 使用特定的 API 金鑰和模型翻譯 PDF 文件：

   ```bash
   pdf2zh --api-key YOUR_API_KEY --model gpt-4 input.pdf
   ```

3. 僅翻譯 PDF 文件的第 1 到第 5 頁：

   ```bash
   pdf2zh --page-range 1-5 input.pdf
   ```

4. 使用配置文件進行翻譯：

   ```bash
   pdf2zh -c config.yaml input.pdf
   ```

#### 配置文件

配置文件是一個 YAML 文件，可以指定與命令行相同的選項。例如：

```yaml
source_language: en
target_language: zh
api_key: your_api_key_here
model: gpt-4
output_type: markdown
```

#### 環境變數

- `PDF2ZH_API_KEY`：翻譯服務的 API 金鑰。這可以用來代替通過命令行指定 API 金鑰。

#### 注意事項

- 如果未指定輸出文件，翻譯後的內容將打印到標準輸出（stdout）。
- 該工具支持以 Markdown、PDF 或純文本格式輸出。默認為 Markdown。
- 對於大型 PDF 文件，建議使用 `--page-range` 選項分塊翻譯。
- The function returns an async generator that yields events. Each event is a dictionary with a `type` field and a `data` field.
- Event types:
    - `start`: Translation started. `data` contains the total number of pages.
    - `page`: A page is translated. `data` contains the page number and the translated content.
    - `progress`: Translation progress. `data` contains the percentage of pages translated.
    - `end`: Translation finished. `data` contains the total number of pages translated.
    - `error`: An error occurred. `data` contains the error message.
- The function does not save the translated file; it only returns the events. The caller is responsible for saving the file if needed.

---

### TRANSLATION RESULT

- 此函數會忽略 `settings.basic.input_files`；僅翻譯給定的 `file`。
- 如果 `settings.basic.debug` 為 True，則翻譯在主進程中運行；否則在子進程中運行。兩者的事件結構相同。
- 該函數返回一個異步生成器，該生成器會產生事件。每個事件都是一個包含 `type` 欄位和 `data` 欄位的字典。
- 事件類型：
    - `start`：翻譯開始。`data` 包含總頁數。
    - `page`：一個頁面已翻譯。`data` 包含頁碼和翻譯後的內容。
    - `progress`：翻譯進度。`data` 包含已翻譯頁面的百分比。
    - `end`：翻譯完成。`data` 包含已翻譯的總頁數。
    - `error`：發生錯誤。`data` 包含錯誤訊息。
- 該函數不會保存翻譯後的文件；它只返回事件。如果需要，呼叫者負責保存文件。

The event stream contract defines the format of the events that are streamed from the server to the client. The events are streamed as Server-Sent Events (SSE) and are encoded as JSON.

#### Event Types

The following event types are defined:

- `status`: The status of the translation job. The event data contains the current status of the job.
- `progress`: The progress of the translation job. The event data contains the current progress of the job.
- `result`: The result of the translation job. The event data contains the result of the job.
- `error`: An error that occurred during the translation job. The event data contains the error message.

#### Event Data

The event data is a JSON object that contains the following fields:

- `event`: The event type.
- `data`: The event data. The structure of the event data depends on the event type.

#### Event Data for `status` Events

The event data for `status` events contains the following fields:

- `status`: The current status of the job. The status can be one of the following:
  - `pending`: The job is pending.
  - `running`: The job is running.
  - `completed`: The job has completed.
  - `failed`: The job has failed.

#### Event Data for `progress` Events

The event data for `progress` events contains the following fields:

- `progress`: The current progress of the job. The progress is a number between 0 and 1.

#### Event Data for `result` Events

The event data for `result` events contains the following fields:

- `result`: The result of the job. The result is a string that contains the translated text.

#### Event Data for `error` Events

The event data for `error` events contains the following fields:

- `error`: The error message.

#### Example

The following is an example of an event stream:

```plaintext
event: status
data: {"status": "pending"}

event: progress
data: {"progress": 0.5}

event: result
data: {"result": "Translated text"}

event: error
data: {"error": "An error occurred"}
```

---

### TRANSLATION RESULT

### 事件串流合約

事件串流合約定義了從伺服器串流到客戶端的事件格式。事件以伺服器發送事件（SSE）的形式串流，並以 JSON 編碼。

#### 事件類型

定義了以下事件類型：

- `status`：翻譯任務的狀態。事件數據包含任務的當前狀態。
- `progress`：翻譯任務的進度。事件數據包含任務的當前進度。
- `result`：翻譯任務的結果。事件數據包含任務的結果。
- `error`：翻譯任務期間發生的錯誤。事件數據包含錯誤訊息。

#### 事件數據

事件數據是一個 JSON 物件，包含以下欄位：

- `event`：事件類型。
- `data`：事件數據。事件數據的結構取決於事件類型。

#### `status` 事件的事件數據

`status` 事件的事件數據包含以下欄位：

- `status`：任務的當前狀態。狀態可以是以下之一：
  - `pending`：任務待處理。
  - `running`：任務執行中。
  - `completed`：任務已完成。
  - `failed`：任務已失敗。

#### `progress` 事件的事件數據

`progress` 事件的事件數據包含以下欄位：

- `progress`：任務的當前進度。進度是一個介於 0 和 1 之間的數字。

#### `result` 事件的事件數據

`result` 事件的事件數據包含以下欄位：

- `result`：任務的結果。結果是一個包含翻譯後文字的字符串。

#### `error` 事件的事件數據

`error` 事件的事件數據包含以下欄位：

- `error`：錯誤訊息。

#### 範例

以下是一個事件串流的範例：

```plaintext
event: status
data: {"status": "pending"}

event: progress
data: {"progress": 0.5}

event: result
data: {"result": "Translated text"}

event: error
data: {"error": "An error occurred"}
```
- `"page"`: A page of the PDF has been processed. The `data` field contains the page number.
- `"progress"`: The overall progress of the translation. The `data` field contains a float between 0 and 1.
- `"text"`: A chunk of translated text. The `data` field contains the text.
- `"error"`: An error occurred. The `data` field contains the error message.
- `"warning"`: A warning occurred. The `data` field contains the warning message.

Example of the event stream:

```json
{"type": "progress", "data": 0.1}
{"type": "page", "data": 1}
{"type": "text", "data": "Translated text chunk 1"}
{"type": "text", "data": "Translated text chunk 2"}
{"type": "progress", "data": 0.5}
{"type": "page", "data": 2}
{"type": "text", "data": "Translated text chunk 3"}
{"type": "progress", "data": 1.0}
```

---

### TRANSLATION RESULT

異步生成器會產生類似 JSON 的字典事件，具有以下類型：
- `"page"`：PDF 的一頁已被處理。`data` 欄位包含頁碼。
- `"progress"`：翻譯的整體進度。`data` 欄位包含一個介於 0 和 1 之間的浮點數。
- `"text"`：一段翻譯後的文字。`data` 欄位包含該文字。
- `"error"`：發生錯誤。`data` 欄位包含錯誤訊息。
- `"warning"`：發生警告。`data` 欄位包含警告訊息。

事件串流的範例：

```json
{"type": "progress", "data": 0.1}
{"type": "page", "data": 1}
{"type": "text", "data": "Translated text chunk 1"}
{"type": "text", "data": "Translated text chunk 2"}
{"type": "progress", "data": 0.5}
{"type": "page", "data": 2}
{"type": "text", "data": "Translated text chunk 3"}
{"type": "progress", "data": 1.0}
```

- `part_index`: if error occurred while processing a part (>=1)

---

### TRANSLATION RESULT

- 階段摘要事件：`stage_summary`（可選，可能首先出現）
  - 欄位
    - `type`："stage_summary"
    - `stages`：物件列表 `{ "name": str, "percent": float }`，描述估計的工作分配
    - `part_index`：此摘要事件的索引可能為 0
    - `total_parts`：總部分數（>= 1）

- 進度事件：`progress_start`、`progress_update`、`progress_end`
  - 共同欄位
    - `type`：上述之一
    - `stage`：人類可讀的階段名稱（例如："解析 PDF 並建立中間表示"、"翻譯段落"、"儲存 PDF"）
    - `stage_progress`：[0, 100] 內的浮點數，表示當前階段內的進度
    - `overall_progress`：[0, 100] 內的浮點數，表示整體進度
    - `part_index`：當前部分索引（進度事件通常從 1 開始）
    - `total_parts`：總部分數（>= 1）。大型文檔可能會自動分割。
    - `stage_current`：階段內的當前步驟
    - `stage_total`：階段內的總步驟數

- 完成事件：`finish`
  - 欄位
    - `type`："finish"
    - `translate_result`：一個提供最終輸出的**物件**（注意：不是字典，而是類別實例）
      - `original_pdf_path`：輸入 PDF 的路徑
      - `mono_pdf_path`：單語翻譯 PDF 的路徑（或 None）
      - `dual_pdf_path`：雙語翻譯 PDF 的路徑（或 None）
      - `no_watermark_mono_pdf_path`：無浮水印的單語輸出路徑（如果產生了），否則為 None
      - `no_watermark_dual_pdf_path`：無浮水印的雙語輸出路徑（如果產生了），否則為 None
      - `auto_extracted_glossary_path`：自動提取的術語表 CSV 路徑（或 None）
      - `total_seconds`：經過的秒數（浮點數）
      - `peak_memory_usage`：翻譯期間的近似記憶體使用峰值（浮點數；實現依賴的單位）

- 錯誤事件：`error`
  - 欄位
    - `type`："error"
    - `error`：人類可讀的錯誤訊息
    - `error_type`：其中之一 `BabeldocError`、`SubprocessError`、`IPCError`、`SubprocessCrashError` 等。
    - `details`：可選的詳細信息（例如，原始錯誤或追蹤資訊）
    - `part_index`：如果在處理某部分時發生錯誤（>=1）

The `pdf2zh` tool is designed to translate PDF documents from various languages into Chinese. It leverages advanced OCR and machine translation technologies to ensure accurate and efficient translations. However, there are certain behaviors and limitations that users should be aware of:

1. **OCR Accuracy**: The tool relies on OCR to extract text from PDFs. The accuracy of OCR can vary depending on the quality of the PDF. For best results, use PDFs with clear, high-resolution text.

2. **Layout Preservation**: The tool attempts to preserve the original layout of the PDF, including images, tables, and formatting. However, complex layouts may not be perfectly preserved, and some manual adjustments might be necessary.

3. **Translation Quality**: The quality of the translation depends on the machine translation model used. While the tool uses state-of-the-art models, some nuances and context-specific meanings may not be fully captured.

4. **Language Support**: The tool supports a wide range of languages, but the quality of translation may vary for less common languages. Always verify the translation for critical documents.

5. **Performance**: The tool is optimized for performance, but large PDFs (e.g., over 500 pages) may take longer to process. Consider breaking large documents into smaller parts for better efficiency.

For more information, refer to the [documentation](https://pdf2zh-next.com) or contact support.

---

### TRANSLATION RESULT

重要行為：`pdf2zh` 工具旨在將各種語言的 PDF 文檔翻譯成中文。它利用先進的 OCR 和機器翻譯技術來確保準確高效的翻譯。然而，用戶應注意某些行為和限制：

1. **OCR 準確性**：該工具依賴 OCR 從 PDF 中提取文本。OCR 的準確性可能因 PDF 的質量而異。為獲得最佳結果，請使用具有清晰、高分辨率文本的 PDF。

2. **佈局保留**：該工具嘗試保留 PDF 的原始佈局，包括圖像、表格和格式。然而，複雜的佈局可能無法完美保留，可能需要一些手動調整。

3. **翻譯質量**：翻譯的質量取決於所使用的機器翻譯模型。雖然該工具使用最先進的模型，但一些細微差別和上下文特定的含義可能無法完全捕捉。

4. **語言支持**：該工具支持多種語言，但對於較不常見的語言，翻譯質量可能會有所不同。對於關鍵文檔，請始終驗證翻譯。

5. **性能**：該工具針對性能進行了優化，但大型 PDF（例如超過 500 頁）可能需要更長的處理時間。考慮將大型文檔拆分為較小的部分以提高效率。

更多信息，請參閱 [文檔](https://pdf2zh-next.com) 或聯繫支持。
- The `finish` event is always the last event.
- If the `output_file` parameter is provided, the translated file will be saved to the specified path, and the stream will only contain progress events.
- The `output_type` parameter controls the format of the output. If set to `'pdf'`, the output will be a PDF file. If set to `'markdown'` or `'text'`, the output will be in the respective text format.
- The `page_range` parameter allows you to specify a range of pages to translate. For example, `'1-5,10'` will translate pages 1 to 5 and page 10.
- The `source_lang` parameter is optional. If not provided, the tool will attempt to auto-detect the source language.
- The `target_lang` parameter is required and specifies the language to translate to.
- The `api_key` parameter is optional if a default API key is set in the environment variables.
- The `api_base` parameter allows you to specify a custom API endpoint. This is useful for using a self-hosted translation service.
- The `model` parameter allows you to specify which translation model to use. If not provided, a default model will be used.
- The `stream` parameter controls whether the results are streamed. If set to `False`, the function will return the translated content as a string once the entire document is processed.
- The function returns an asynchronous iterator that yields events of different types. The event types include `text`, `page`, `progress`, `error`, and `finish`.
- Each event is a dictionary with a `type` field indicating the event type and a `data` field containing the event-specific data.
- For `text` events, the `data` field contains a string with the translated text.
- For `page` events, the `data` field contains the page number that has been processed.
- For `progress` events, the `data` field contains a float between 0 and 1 indicating the progress percentage.
- For `error` events, the `data` field contains an error message string.
- The `finish` event indicates that the translation has completed successfully. The `data` field may contain a summary of the translation process.
- The function is designed to handle large documents efficiently by streaming the results as they become available.
- If an error occurs during translation, the generator will yield an `error` event and then raise an exception. You should handle both the error event and the exception to ensure robust error handling.
- The function supports both file paths and in-memory file data (as bytes) for the `file` parameter.
- The function uses the specified translation service (e.g., OpenAI, Aliyun, SiliconFlow) to perform the translation. The translation service must be configured with the appropriate API key and endpoint.
- The function respects the rate limits and quotas of the translation service. If the rate limit is exceeded, the function may retry the request after a delay.
- The function includes retry logic for transient errors (e.g., network timeouts). The number of retries and the delay between retries can be configured.
- The function logs detailed information about the translation process, including the number of pages processed, the time taken, and any errors encountered.
- The function can be used in both synchronous and asynchronous contexts. For synchronous use, you can wrap the call in an event loop. However, it is recommended to use the asynchronous version for better performance when dealing with large documents.
- The function is part of the `pdf2zh` package, which provides a comprehensive solution for translating PDF documents into Chinese.
- The `pdf2zh` package includes both a command-line interface (CLI) and a Python API for flexibility.
- The CLI supports all the parameters available in the Python API, allowing you to use the tool from the command line without writing any code.
- The Python API provides more control over the translation process, including the ability to process the stream of events in real-time.
- The `pdf2zh` package is open-source and available on GitHub. Contributions and bug reports are welcome.
- For more information, see the [documentation](https://pdf2zh-next.com) or join the [community](https://pdf2zh-next.com/community) for support.

---

### TRANSLATION RESULT

- 在進度開始之前，可能會發出一個可選的 `stage_summary`。
- 在某些失敗情況下，生成器將首先產生一個 `error` 事件，然後引發一個衍生自 `TranslationError` 的異常。您應該同時檢查錯誤事件並準備捕獲異常。
- `progress_update` 事件可能會重複出現相同的值；必要時消費者應進行防抖處理。
- 當您收到 `finish` 事件時，請停止消費串流。
- `finish` 事件總是最後一個事件。
- 如果提供了 `output_file` 參數，翻譯後的文件將保存到指定路徑，並且串流將僅包含進度事件。
- `output_type` 參數控制輸出的格式。如果設置為 `'pdf'`，輸出將是 PDF 文件。如果設置為 `'markdown'` 或 `'text'`，輸出將是相應的文字格式。
- `page_range` 參數允許您指定要翻譯的頁面範圍。例如，`'1-5,10'` 將翻譯第 1 到第 5 頁以及第 10 頁。
- `source_lang` 參數是可選的。如果未提供，工具將嘗試自動檢測源語言。
- `target_lang` 參數是必需的，用於指定要翻譯成的語言。
- 如果在環境變數中設置了默認 API 金鑰，則 `api_key` 參數是可選的。
- `api_base` 參數允許您指定自定義 API 端點。這對於使用自託管的翻譯服務非常有用。
- `model` 參數允許您指定要使用的翻譯模型。如果未提供，將使用默認模型。
- `stream` 參數控制是否串流結果。如果設置為 `False`，該函數將在整個文檔處理完畢後將翻譯內容作為字符串返回。
- 該函數返回一個異步迭代器，會產生不同類型的事件。事件類型包括 `text`、`page`、`progress`、`error` 和 `finish`。
- 每個事件都是一個字典，其中包含一個指示事件類型的 `type` 欄位和一個包含事件特定數據的 `data` 欄位。
- 對於 `text` 事件，`data` 欄位包含翻譯後文字的字符串。
- 對於 `page` 事件，`data` 欄位包含已處理的頁碼。
- 對於 `progress` 事件，`data` 欄位包含一個介於 0 和 1 之間的浮點數，表示進度百分比。
- 對於 `error` 事件，`data` 欄位包含一個錯誤訊息字符串。
- `finish` 事件表示翻譯已成功完成。`data` 欄位可能包含翻譯過程的摘要。
- 該函數設計用於通過在結果可用時進行串流來高效處理大型文檔。
- 如果在翻譯過程中發生錯誤，生成器將產生一個 `error` 事件，然後引發異常。您應該同時處理錯誤事件和異常，以確保穩健的錯誤處理。
- 該函數支持文件路徑和內存中的文件數據（作為字節）作為 `file` 參數。
- 該函數使用指定的翻譯服務（例如 OpenAI、阿里雲、硅基流動）來執行翻譯。翻譯服務必須配置適當的 API 金鑰和端點。
- 該函數遵守翻譯服務的速率限制和配額。如果超過速率限制，該函數可能會在延遲後重試請求。
- 該函數包含針對瞬態錯誤（例如網絡超時）的重試邏輯。重試次數和重試之間的延遲可以配置。
- 該函數記錄有關翻譯過程的詳細信息，包括處理的頁數、花費的時間以及遇到的任何錯誤。
- 該函數可以在同步和異步上下文中使用。對於同步使用，您可以將調用包裝在事件循環中。但是，在處理大型文檔時，建議使用異步版本以獲得更好的性能。
- 該函數是 `pdf2zh` 套件的一部分，該套件提供了將 PDF 文檔翻譯成中文的全面解決方案。
- `pdf2zh` 套件包括命令行界面（CLI）和 Python API，以提供靈活性。
- CLI 支持 Python API 中可用的所有參數，允許您從命令行使用該工具而無需編寫任何代碼。
- Python API 提供了對翻譯過程的更多控制，包括實時處理事件串流的能力。
- `pdf2zh` 套件是開源的，可在 GitHub 上獲得。歡迎貢獻和錯誤報告。
- 更多信息，請參閱 [文檔](https://pdf2zh-next.com) 或加入 [社區](https://pdf2zh-next.com/community) 以獲得支持。

{#minimal-usage-example-async}

!!! Note "Note"
    This example uses the `pdf2zh` Python package to translate a PDF file asynchronously. The API key is obtained from the environment variable `PDF2ZH_API_KEY`.

```python
import asyncio
import os
from pdf2zh import AsyncPDFTranslator

async def main():
    # Initialize the translator with your API key
    translator = AsyncPDFTranslator(api_key=os.getenv("PDF2ZH_API_KEY"))
    
    # Translate a PDF file
    result = await translator.translate(
        input_file="input.pdf",
        output_file="output.pdf",
        source_lang="en",
        target_lang="zh"
    )
    
    print(f"Translation completed: {result}")

# Run the async function
asyncio.run(main())
```

### Minimal Usage Example (Sync) {#minimal-usage-example-sync}

!!! Note "Note"
    This example uses the `pdf2zh` Python package to translate a PDF file synchronously.

```python
import os
from pdf2zh import PDFTranslator

def main():
    # Initialize the translator with your API key
    translator = PDFTranslator(api_key=os.getenv("PDF2ZH_API_KEY"))
    
    # Translate a PDF file
    result = translator.translate(
        input_file="input.pdf",
        output_file="output.pdf",
        source_lang="en",
        target_lang="zh"
    )
    
    print(f"Translation completed: {result}")

if __name__ == "__main__":
    main()
```

---

### OUTPUT

### 最小使用範例（異步） {#最小使用範例 - 異步}

!!! Note "注意"
    此範例使用 `pdf2zh` Python 套件來異步翻譯 PDF 文件。API 金鑰從環境變數 `PDF2ZH_API_KEY` 中獲取。

```python
import asyncio
import os
from pdf2zh import AsyncPDFTranslator

async def main():
    # 使用您的 API 金鑰初始化翻譯器
    translator = AsyncPDFTranslator(api_key=os.getenv("PDF2ZH_API_KEY"))
    
    # 翻譯一個 PDF 文件
    result = await translator.translate(
        input_file="input.pdf",
        output_file="output.pdf",
        source_lang="en",
        target_lang="zh"
    )
    
    print(f"Translation completed: {result}")

# 運行異步函數
asyncio.run(main())
```

### 最小使用範例（同步） {#最小使用範例 - 同步}

!!! Note "注意"
    此範例使用 `pdf2zh` Python 套件來同步翻譯 PDF 文件。

```python
import os
from pdf2zh import PDFTranslator

def main():
    # 使用您的 API 金鑰初始化翻譯器
    translator = PDFTranslator(api_key=os.getenv("PDF2ZH_API_KEY"))
    
    # 翻譯一個 PDF 文件
    result = translator.translate(
        input_file="input.pdf",
        output_file="output.pdf",
        source_lang="en",
        target_lang="zh"
    )
    
    print(f"Translation completed: {result}")

if __name__ == "__main__":
    main()
```
```python
import asyncio
from pathlib import Path
from pdf2zh_next.high_level import do_translate_async_stream

# Assume you already have a valid SettingsModel instance named `settings`
# and a PDF file path

async def translate_one(settings, pdf_path: str | Path):
    try:
        async for event in do_translate_async_stream(settings, pdf_path):
            etype = event.get("type")

            if etype == "stage_summary":
                # Optional pre-flight summary of stages
                stages = event.get("stages", [])
                print("Stage summary:", ", ".join(f"{s['name']}:{s['percent']:.2f}" for s in stages))

            elif etype in {"progress_start", "progress_update", "progress_end"}:
                stage = event.get("stage")
                stage_prog = event.get("stage_progress")  # 0..100
                overall = event.get("overall_progress")  # 0..100
                part_i = event.get("part_index")
                part_n = event.get("total_parts")
                print(f"[{etype}] {stage} | stage {stage_prog:.1f}% | overall {overall:.1f}% (part {part_i}/{part_n})")

            elif etype == "error":
                # You will also get a raised exception after this yield
                print("[error]", event.get("error"), event.get("error_type"))

            elif etype == "finish":
                result = event["translate_result"]
                print("Done in", getattr(result, "total_seconds", None), "s")
                print("Mono:", getattr(result, "mono_pdf_path", None))
                print("Dual:", getattr(result, "dual_pdf_path", None))
                print("No-watermark Mono:", getattr(result, "no_watermark_mono_pdf_path", None))
                print("No-watermark Dual:", getattr(result, "no_watermark_dual_pdf_path", None))
                print("Glossary:", getattr(result, "auto_extracted_glossary_path", None))
                print("Peak memory:", getattr(result, "peak_memory_usage", None))
                break

    except Exception as exc:
        # Catch exceptions raised by the stream after an error event
        print("Translation failed:", exc)

# asyncio.run(translate_one(settings, "/path/to/file.pdf"))
```

If you are not satisfied with the service, you can request a refund within 7 days of purchase.

Please note that we will not refund for the following reasons:

- You have already used the service and are satisfied with the result.
- You have already used the service and are not satisfied with the result, but you have not provided any evidence to support your claim.
- You have already used the service and are not satisfied with the result, but you have not contacted us for support.

If you have any questions, please contact us at [support@pdf2zh.com](mailto:support@pdf2zh.com).

---

### OUTPUT

### 取消政策

如果您對服務不滿意，可以在購買後 7 天內申請退款。

請注意，以下情況我們將不予退款：

- 您已經使用了服務並且對結果滿意。
- 您已經使用了服務但對結果不滿意，但您沒有提供任何證據來支持您的主張。
- 您已經使用了服務但對結果不滿意，但您沒有聯繫我們尋求支援。

如果您有任何疑問，請透過 [support@pdf2zh.com](mailto:support@pdf2zh.com) 與我們聯繫。
For example, you can cancel the task if the user closes the browser tab or navigates away from the page.

### Example

```python
import asyncio
from pdf2zh import do_translate_async_stream

async def main():
    # Create a task for the translation stream
    task = asyncio.create_task(
        do_translate_async_stream(
            file="document.pdf",
            target_lang="zh",
            source_lang="en",
            page_range="1-5",
            output_type="markdown",
            api_key="your_api_key",
        )
    )
    
    # Simulate cancellation after 2 seconds
    await asyncio.sleep(2)
    task.cancel()
    
    try:
        async for chunk in task:
            print(chunk)
    except asyncio.CancelledError:
        print("Task was cancelled")

asyncio.run(main())
```

### Notes

- Cancelling the task will stop the translation process and release any resources associated with it.
- If the translation process has already started, cancelling the task may leave partial results in the output file if one was specified.

---

### TRANSLATION RESULT

您可以取消消耗串流的任務。取消操作會傳播到底層的翻譯過程。
例如，如果用戶關閉瀏覽器標籤頁或離開頁面，您可以取消任務。

### 範例

```python
import asyncio
from pdf2zh import do_translate_async_stream

async def main():
    # 為翻譯串流創建一個任務
    task = asyncio.create_task(
        do_translate_async_stream(
            file="document.pdf",
            target_lang="zh",
            source_lang="en",
            page_range="1-5",
            output_type="markdown",
            api_key="your_api_key",
        )
    )
    
    # 模擬 2 秒後取消
    await asyncio.sleep(2)
    task.cancel()
    
    try:
        async for chunk in task:
            print(chunk)
    except asyncio.CancelledError:
        print("Task was cancelled")

asyncio.run(main())
```

### 注意事項

- 取消任務將停止翻譯過程並釋放與之相關的任何資源。
- 如果翻譯過程已經開始，取消任務可能會在輸出文件中留下部分結果（如果指定了輸出文件）。

```python
import asyncio
from pdf2zh_next.high_level import do_translate_async_stream

async def cancellable(settings, pdf):
    task = asyncio.create_task(_consume(settings, pdf))
    await asyncio.sleep(1.0)  # let it start
    task.cancel()
    try:
        await task
    except asyncio.CancelledError:
        print("Cancelled")

async def _consume(settings, pdf):
    async for event in do_translate_async_stream(settings, pdf):
        if event["type"] == "finish":
            break
```

The following table provides examples of different event shapes and their corresponding descriptions:

| Shape | Description |
|-------|-------------|
| ![](https://raw.githubusercontent.com/facebookresearch/theseus/main/docs/source/_static/img/event_shapes/point.png) | Point event: A single point in time. |
| ![](https://raw.githubusercontent.com/facebookresearch/theseus/main/docs/source/_static/img/event_shapes/interval.png) | Interval event: A continuous range of time. |
| ![](https://raw.githubusercontent.com/facebookresearch/theseus/main/docs/source/_static/img/event_shapes/gap.png) | Gap event: A discontinuous interval with a gap. |
| ![](https://raw.githubusercontent.com/facebookresearch/theseus/main/docs/source/_static/img/event_shapes/periodic.png) | Periodic event: Repeats at regular intervals. |
| ![](https://raw.githubusercontent.com/facebookresearch/theseus/main/docs/source/_static/img/event_shapes/sparse.png) | Sparse event: Occurs infrequently with irregular gaps. |

---

### TRANSLATION RESULT

### 事件形狀範例

下表提供了不同事件形狀的範例及其對應的描述：

| 形狀 | 描述 |
|-------|-------------|
| ![](https://raw.githubusercontent.com/facebookresearch/theseus/main/docs/source/_static/img/event_shapes/point.png) | 點事件：單一時間點。 |
| ![](https://raw.githubusercontent.com/facebookresearch/theseus/main/docs/source/_static/img/event_shapes/interval.png) | 區間事件：連續的時間範圍。 |
| ![](https://raw.githubusercontent.com/facebookresearch/theseus/main/docs/source/_static/img/event_shapes/gap.png) | 間隙事件：具有間隙的不連續區間。 |
| ![](https://raw.githubusercontent.com/facebookresearch/theseus/main/docs/source/_static/img/event_shapes/periodic.png) | 週期性事件：以固定間隔重複發生。 |
| ![](https://raw.githubusercontent.com/facebookresearch/theseus/main/docs/source/_static/img/event_shapes/sparse.png) | 稀疏事件：不頻繁發生且具有不規則間隔的事件。 |
This event is emitted when a stage of the translation process is completed. It contains a summary of the stage, including the number of pages processed, the time taken, and any errors encountered.

```json
{
  "event": "stage_summary",
  "data": {
    "stage": "translation",
    "pages_processed": 10,
    "time_taken": 30.5,
    "errors": []
  }
}
```

---

### TRANSLATION RESULT

階段摘要事件（範例）：此事件在翻譯過程的某個階段完成時發出。它包含該階段的摘要，包括處理的頁數、花費的時間以及遇到的任何錯誤。

```json
{
  "event": "stage_summary",
  "data": {
    "stage": "translation",
    "pages_processed": 10,
    "time_taken": 30.5,
    "errors": []
  }
}
```
```json
{
  "type": "stage_summary",
  "stages": [
    {"name": "Parse PDF and Create Intermediate Representation", "percent": 0.1086},
    {"name": "DetectScannedFile", "percent": 0.0188},
    {"name": "Parse Page Layout", "percent": 0.1079}
    // ... more stages ...
  ],
  "part_index": 0,
  "total_parts": 1
}
```

`{"type": "progress", "data": {"progress": 0.5, "message": "Processing page 5 of 10"}}`

### TRANSLATION RESULT

進度事件（範例）：`{"type": "progress", "data": {"progress": 0.5, "message": "Processing page 5 of 10"}}`
```json
{
  "type": "progress_update",
  "stage": "Translate Paragraphs",
  "stage_progress": 2.04,
  "stage_current": 1,
  "stage_total": 49,
  "overall_progress": 53.44,
  "part_index": 1,
  "total_parts": 1
}
```

The finish event is emitted when the translation job is completed. The event data contains the final result of the translation.

```json
{
  "event": "finish",
  "data": {
    "result": "Translated text"
  }
}
```

Error event (example): The error event is emitted when an error occurs during the translation process. The event data contains the error message.

```json
{
  "event": "error",
  "data": {
    "error": "An error occurred"
  }
}
```

---

### TRANSLATION RESULT

完成事件（範例）：當翻譯任務完成時，會發出完成事件。事件數據包含翻譯的最終結果。

```json
{
  "event": "finish",
  "data": {
    "result": "Translated text"
  }
}
```

錯誤事件（範例）：當翻譯過程中發生錯誤時，會發出錯誤事件。事件數據包含錯誤訊息。

```json
{
  "event": "error",
  "data": {
    "error": "An error occurred"
  }
}
```
```json
{
  "type": "finish",
  "translate_result": {
    "original_pdf_path": "pdf2zh_files/<session>/table.pdf",
    "mono_pdf_path": "pdf2zh_files/<session>/table.zh-CN.mono.pdf",
    "dual_pdf_path": "pdf2zh_files/<session>/table.zh-CN.dual.pdf",
    "no_watermark_mono_pdf_path": "pdf2zh_files/<session>/table.no_watermark.zh-CN.mono.pdf",
    "no_watermark_dual_pdf_path": "pdf2zh_files/<session>/table.no_watermark.zh-CN.dual.pdf",
    "auto_extracted_glossary_path": "pdf2zh_files/<session>/table.zh-CN.glossary.csv",
    "total_seconds": 42.83,
    "peak_memory_usage": 4651.55
  }
}
```

The `error` event is emitted when an error occurs during the translation process. The event data contains the error message.

```json
{
  "event": "error",
  "data": {
    "error": "An error occurred while translating the document."
  }
}
```

---

### TRANSLATION RESULT

錯誤事件（範例）：當翻譯過程中發生錯誤時，會發出 `error` 事件。事件數據包含錯誤訊息。

```json
{
  "event": "error",
  "data": {
    "error": "翻譯文件時發生錯誤。"
  }
}
```
```json
{
  "type": "error",
  "error": "Babeldoc translation error: <message>",
  "error_type": "BabeldocError",
  "details": "<optional original error or traceback>"
}
```

!!! Note

    - **File Size & Structure**: Smaller documents (less than 100 pages) with a clear structure (e.g., academic papers, reports) will generally have better results.
    - **Image & Table Recognition**: The tool automatically detects and processes images and tables within the PDF. However, complex layouts or low-quality scans may require manual adjustments.
    - **Language Support**: The tool supports multiple languages. For the best results, ensure the source and target languages are correctly specified in the configuration. See [Supported Languages](https://pdf2zh-next.com/advanced/SUPPORTED_LANGUAGES.md) for more details.

---

### OUTPUT LANGUAGE

zh_TW
---

### TRANSLATION RESULT

- 始終處理來自生成器的錯誤事件和異常。
- 在 `finish` 時中斷循環，以避免不必要的工作。
- 在呼叫前確保 `file` 存在且 `settings.validate_settings()` 通過。
- 大型文檔可能會被拆分；使用 `part_index/total_parts` 和 `overall_progress` 來驅動您的 UI。
- 如果您的 UI 對重複的相同更新敏感，請對 `progress_update` 進行防抖處理。
- `report_interval` (SettingsModel)：僅控制 `progress_update` 事件的發射頻率。它不影響 `stage_summary`、`progress_start`、`progress_end` 或 `finish`。預設為 0.1 秒，最小允許值為 0.05 秒。根據進度監控邏輯，當 `stage_total <= 3` 時，更新不受 `report_interval` 的限制。

<div align="right"> 
<h6><small>Some content on this page has been translated by GPT and may contain errors.</small></h6>